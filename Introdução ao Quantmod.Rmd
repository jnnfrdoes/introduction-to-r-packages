---
title: "Introducao ao Quantmod"
output:
  html_notebook: default
  word_document: default
---
Autoras:
[Alexsandra Carvalho](https://www.linkedin.com/in/alexsandrabispocarvalho/)
e
[Jennifer Do  √â](https://www.linkedin.com/in/jennifer-do-%C3%A9/)

[Refer√™ncias](https://cran.r-project.org/web/packages/quantmod/quantmod.pdf)

Autor do Pacote: [Joshua M. Ulrich](https://github.com/joshuaulrich/quantmod)

**Apresentando o pacote**

O pacote quantmod foi criado para auxiliar as pessoas que trabalham ou t√™m interesse na √°rea das finan√ßas quantitativas no desenvolvimento, teste e implanta√ß√£o de modelos baseados em estat√≠stica. 
O quantmod, por meio de suas ferramentas, permite ao usu√°rio R baixar dados de a√ß√µes, como abertura, fechamento, m√°ximo, m√≠nimo, desdobramentos e dividendos. O pacote tamb√©m permite ao usu√°rio o c√°lculo de porcentagens e retornos di√°rios, mensais e anuais.

**Primeiros Passos**

Iniciaremos entendendo as fun√ß√µes b√°sicas do pacote. Para tal, o nosso primeiro passo ser√° fazer a instala√ß√£o e ativa√ß√£o.
```{r}
# Instalando
install.packages("quantmod")

# Ativando
library(quantmod)
```

**1. Calculando a Varia√ß√£o Percentual**

Entende-se a porcentagem (%) como sendo o resultado do quociente de um n√∫mero qualquer (n) por 100. Vamos tomar o seguinte exemplo:

*25/100 = 0,025 ou 25%*

‚Ä¢ A Varia√ß√£o percentual, geralmente denotado pelo s√≠mbolo delta (üúÇ), √© dada da seguinte forma: üúÇ = (Valor Final/Valor Inicial)-1

**M√£os √† obra**

Agora que j√° relembramos os principais pontos, passaremos para o entendimento de como criar objetos e utilizar fun√ß√µes que nos permitir√£o aplicar os conceitos acima descritos. 

‚Ä¢ Criando Objetos

Existem duas formas principais de criar objetos. Ao utilizarmos **<-**  ou **=**, estamos dizendo ao R que queremos criar um objeto. Por exemplo:
```{r}
x = 5
y = 17
z <- x + y
```

```{r}
# Criando um vetor aleat√≥rio de pre√ßos de abertura e fechamento.
abertura <- c(10.3,10.01,9.99,10.01,10.5)   # Criando uma matriz 1x5 de pre√ßos de abertura.
fechamento <- c(9.9,9.8,10.2,10.5,10.8)     # Criando uma matriz 1x5 de pre√ßos de fechamento.

# Para visualiza√ß√£o.
abertura
fechamento
```

‚Ä¢ Calculando a varia√ß√£o percentual

A fun√ß√£o utilizada no R pode ser expressa da seguinte forma:

Delt(x1, x2 = NULL, k = 0, type = c("arithmetic", "log"))

- A fun√ß√£o delta calcula a varia√ß√£o percentual
- x1 e x2 s√£o marizes de comprimento 
- k corresponde a mudan√ßa percentual entre k per√≠odos
- type corresponde ao tipo de varia√ß√£o: Logaritm√≠ca ou aritm√©tica (Padr√£o).


```{r}
Delt(abertura)                   # Calculando a varia√ß√£o percentual dos pre√ßos de abertura.
Delt(fechamento)                 # Calculando a varia√ß√£o percentual dos pre√ßos de fechamento.
```

```{r}
Delt(abertura,type='arithmetic') # Usando a varia√ß√£o padr√£o.
Delt(abertura,type='log')        # Usando a Varia√ß√£o logar√≠tmica.
```

```{r}
Delt(abertura,fechamento)        # Calculando a varia√ß√£o percentual entre a abertura e o fechamento do mercado. 
                                 # Como o type n√£o foi informado, o defaut (aritm√©tico) √© usado.
                                 # Como k n√£o foi informado, assume-se o default k=0.
```



**2. Baixando dados de pre√ßos de a√ß√µes**

O getSymbols √© usado  para carregar dados de v√°rias fontes, sejam locais ou remotas. As fontes atualmente dispon√≠veis s√£o: yahoo, google, MySQL, FRED, entre outros.
 
 - Baixando dados do [Yahoo Finance](https://br.financas.yahoo.com/)
 
Ap√≥s a decis√£o de qual a√ß√£o os dados ser√£o baixandos, √© preciso direcionar-se ao site do Yahoo Finance e obter o c√≥digo da a√ß√£o. Para empresas brasileiras, o ticker vem acompanhado de ".SA"

Exemplos: Ibovespa ("^BVSP"), Petz ("PETZ3.SA"), Petrobr√°s ("PETR4.SA") e Bradesco ("BBDC3.SA"). O n√∫mero apresentado no ticker ir√° variar se a a√ß√£o √© preferencial ou ordin√°ria.

A base de dados baixada fornecer√° informa√ß√µes sobre o pre√ßo de abertura, pre√ßo de fechamento, m√°ximo, m√≠nimo e fechamento ajustado.

```{r}
# Obtendo dados usando getSymbols
getSymbols(Symbols= 'BBDC3.SA',       # Baixando dados da a√ß√£o do Banco do Bradesco
           from='2020-01-01',         # Inicio da s√©rie em 01/01/2020
           to='2021-01-01',           # Fim da s√©rie em 01/01/2021. √â poss√≠vel substituir pela fun√ß√£o "sys.date" que retorna o dia atual.
           src = 'yahoo', verbose=F)  # Fonte: Yahoo Finance


```

```{r}
# Removendo NA's
na.omit(BBDC3.SA)

# Visualizando os seis primeiros valores
head(BBDC3.SA)

# Visualizando os seis ultimos valores valores
tail(BBDC3.SA)

#Plotando o gr√°fico da s√©rie
plot(BBDC3.SA)

```


**3. Calculando retornos peri√≥dicos**

Em termos financeiros, os investidores enfrentam o *tradeoff* b√°sico entre risco e retorno, dessa forma, quanto maior o risco de um investimento maior o retorno exigido.
√â esperado que quando deparado com dois investimentos com o mesmo retorno e riscos diferentes, se agir de forma racional, o investidor escolheria aquele com o menor risco.

Assumindo que uma a√ß√£o n√£o pagou dividendos no per√≠odo, o retorno de uma a√ß√£o √© dado da seguinte forma:

R*t* = (P*t*- P*t-1*)-1. Onde:

- R*t* = Retorno no per√≠odo *t*

- P*t* = Pre√ßo da a√ß√£o na data *t*

- P*t-1* = Pre√ßo do ativo na data *t-1)

Para o Calculo do retorno, usaremos a base de dados dos pre√ßos da a√ß√£o do Banco do Bradesco que foi baixada anteriormente 
```{r}
#Retorns Mensais
periodReturn(BBDC3.SA, period='monthly', subset=NULL, type='arithmetic', leading=TRUE) 
#'montly' pode ser substituido por "daily", "weekly", "quarterly" e "yearly"
# type pode ser escolhido entre "arithmetic" e "log"

#Retorno em 2020
periodReturn(BBDC3.SA,period='yearly',subset='2020') 

# Salvando o Retorno Anual em um objeto
retorno_diario <- dailyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

# Calculando o retorno entre datas espec√≠ficas
# Criando uma janela com os dados entre datas e salvando em um objeto √† parte
r <- window(retorno_diario, start = '2020-01-01',  end= '2020-05-31',)

# Omitindo dados faltantes
na.omit(r)
```

- Outra forma de calcular:

```{r}
#Retornos di√°rios
dailyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

#Retornos semanais 
weeklyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

#Retornos mensais
monthlyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

#Retornos trimestrais
quarterlyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

#Retornos anuais
annualReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)
yearlyReturn(BBDC3.SA, subset=NULL, type='arithmetic', leading=TRUE)

```


**4. Baixando o hist√≥rico de dividendos de uma empresa**

Dividendo √© a distribui√ß√£o da fra√ß√£o dos lucros de uma empresa a seus acionistas, pagos exclusivamente em dinheiro e isentos de imposto de renda. Cada empresa pode definir em seu estatudo a parcela dos lucros que ser√° distribuida, respeitando o m√≠nimo de 25% definido por lei.

```{r}
#Baixando dados de distribui√ß√£o de dvidendos e salvando num objeto
dividendos <- getDividends("BBDC3.SA", from = "2020-01-01", to = Sys.Date(), 
              env = parent.frame(), src = "yahoo", auto.assign = FALSE,
              auto.update = FALSE, verbose = FALSE, split.adjust = TRUE,
              curl.options = list())

```

**5. Baixando dados de desdobramento de a√ß√µes**

Defini√ß√£o de desdobramento:

O desdobramento de uma a√ß√£o nada mais √© que o auemnto da quantidade de a√ß√µes com o objetivo de uma maior liquidez, reduzindo o seu valor.
Exemplo: A√ß√£o da empresa A tem valor de 100,00 reais. Ap√≥s um desdobramento, um investidor que possuia uma a√ß√£o da empresa A possuir√° agora 10 a√ß√µes com valor de 10,00 reais cada, 

```{r}
# Baixando e salvando em um objeto

desdobramentos <- getSplits("BBDC3.SA", from = "2000-01-01", to = Sys.Date(), env = parent.frame(), 
    src = "yahoo", auto.assign = FALSE, auto.update = FALSE, verbose = FALSE, curl.options = list())

```

**6. Baixando o pre√ßos ajustado de *abertura, m√°ximo, m√≠nimo e fechamento* para desdobramentos e dividendos**

O defaut √© ajustar por dividendos e splits conjuntamente.

```{r}
# Ap√≥s baixar a s√©rie, usamos o comando head() para vizualisar os primeiros valores
head(BBDC3.SA) 

#Criando um objeto com os pre√ßos ajustados
BBDC3.SA.a <- adjustOHLC(BBDC3.SA)
head(BBDC3.SA.a)

```



